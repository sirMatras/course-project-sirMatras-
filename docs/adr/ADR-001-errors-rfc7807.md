# ADR-001 — RFC 7807 (Problem Details) для HTTP API

## Статус
Принято

## Контекст
Сейчас API возвращает кастомный формат ошибок с полями `code`, `message`, `details`. Для интероперабельности и ясности требуется стандартизированный формат ошибок, поддержка корреляции для отладки и безопасное раскрытие деталей.

## Решение
- Принять стандарт RFC 7807 (`application/problem+json`) для всех ошибок.
- Включать поля: `type`, `title`, `status`, `detail`, `correlation_id`.
- Генерировать `correlation_id` на каждый запрос через middleware и возвращать его в каждом problem-ответе.
- Маскировать внутренние детали для 5xx; ошибки валидации отдавать в сжатом и понятном виде.
- Отобразить доменные исключения (Unauthorized, Forbidden, NotFound, BadRequest) на RFC 7807 единообразно.

## Последствия
- Клиенты получают единый контракт ошибок и могут логировать `correlation_id` для поддержки.
- Существующие тесты, ожидавшие старый формат, обновляются; добавляются тесты для problem+json.

## Ссылки
- NFR-xx (P03): обработка ошибок и наблюдаемость
- P04: F#/R# по маскированию деталей и улучшению DX
- Тесты: `tests/test_rfc7807.py`
- Закрывает риск: утечка внутренних деталей (RISKS.md) — проверка через утверждение, что сообщения 5xx обобщены..


