# ADR-003 — Управление секретами

## Статус  
Принято

## Контекст  
Сервис использует JWT-секрет и другие чувствительные настройки. Нужно гарантировать, что секреты не попадают в репозиторий, подтягиваются из окружения и могут ротироваться.

## Решение  
- Источник — переменные окружения через `pydantic-settings` (`JWT_SECRET`, `JWT_ALGORITHM` и т.д.).  
- Не логировать секреты; логировать лишь длину или метаданные.  
- Разрешить ротацию перезапуском с новым `JWT_SECRET` (замечание: текущие токены станут недействительны — допустимо в рамках учебного проекта).  
- Для продакшена рекомендовать внешние хранилища секретов (Azure Key Vault, AWS Secrets Manager) — зафиксировано для будущих ADR.

## Последствия  
- Секреты не попадают в код и VCS. Ротация проста операционно.  
- Недействительность токенов при ротации — приемлемый компромисс здесь.

## Ссылки  
- NFR-xx: конфиденциальность (P03)  
- P04: F#/R# — снижения рисков по STRIDE (spoofing/tampering)  
- Тесты: косвенно (секрет не логируется); `app/main.py` печатает только алгоритм и длину секрета.  
- Закрывает риск: утечка секрета в логах/репо (RISKS.md) — проверка ревью и логами.
