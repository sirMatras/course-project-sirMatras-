# ADR-002 — Ограничение частоты запросов для /auth/login

## Статус  
Принято

## Контекст  
Точки входа для аутентификации часто становятся целями брутфорса и атак типа credential stuffing. Необходим базовый механизм ограничения частоты запросов для снижения риска злоупотреблений, при этом без использования тяжёлой инфраструктуры.

## Решение  
- Внедрить лёгкое in-memory ограничение частоты запросов для `/auth/login`, используя IP-адрес клиента в качестве ключа.  
- Политика: ограничение в 5 запросов за 60 секунд на один IP-адрес. Превышение лимита — ответ 429 с использованием RFC 7807.  
- Реализовать как зависимость FastAPI, чтобы в будущем легко заменить на более масштабируемые решения, такие как Redis или NGINX.

## Последствия  
- Снижает эффективность брутфорса на логин.  
- В stateless-средах может понадобиться общий стор, но интерфейс позволит легко перейти на более сложные решения в будущем.

## Ссылки  
- NFR-xx: безопасность и защита от злоупотреблений (P03)  
- P04: F#/R# по угрозам аутентификации (STRIDE: D, E)  
- Тесты: `tests/test_rate_limit.py`  
- Закрывает риск: брутфорс логина (RISKS.md) — проверка через получение ответа 429 после превышения порога.
