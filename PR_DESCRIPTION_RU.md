# P06: Secure Coding ‚Äî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–î–∞–Ω–Ω—ã–π PR —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–∞–∫—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–∞–º–∫–∞—Ö **P06**, –≤–Ω–µ–¥—Ä—è—è **3+ –∫–æ–Ω—Ç—Ä–æ–ª–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –∏–∑ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ —Å–ø–∏—Å–∫–∞:

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞** (Input Validation & Normalization)
   - –¢–∏–ø—ã, –¥–ª–∏–Ω—ã, —Å—Ç—Ä–æ–≥–∞—è —Å—Ö–µ–º–∞ —á–µ—Ä–µ–∑ Pydantic
   - Email –≤–∞–ª–∏–¥–∞—Ü–∏—è (`EmailStr`), –ø–∞—Ä–æ–ª–∏ (min_length=8, max_length=256)
   - –î–ª–∏–Ω–∞ –ø–æ–ª–µ–π (name: 1-100, note: max 500)
   - –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–ª—è –¥–∞—Ç (–Ω–µ –±—É–¥—É—â–µ–µ –≤—Ä–µ–º—è)
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢–µ—Å—Ç—ã `test_email_validation`, `test_password_validation`, `test_exercise_validation_long_name`

2. **–û—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ RFC 7807** (RFC 7807 Error Format)
   - –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π (–±–µ–∑ —É—Ç–µ—á–∫–∏ stack traces)
   - Correlation ID –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã `application/problem+json`
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢–µ—Å—Ç—ã `test_rfc7807.py`, `test_errors.py` (422, 400, 404, 401 —Å correlation_id)

3. **–°–µ–∫—Ä–µ—Ç—ã** (Secrets Management)
   - –°–µ–∫—Ä–µ—Ç—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `pydantic-settings`
   - –ó–∞–ø—Ä–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: –∞–ª–≥–æ—Ä–∏—Ç–º, –¥–ª–∏–Ω–∞)
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ö–æ–¥ `src/app/settings.py`, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `src/app/main.py`

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- Rate limiting –¥–ª—è `/auth/login` (5 –∑–∞–ø—Ä–æ—Å–æ–≤/60 —Å–µ–∫ –Ω–∞ IP) ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
  - **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢–µ—Å—Ç `test_rate_limit.py` (–∞—Ç–∞–∫–∞ 6+ –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí 429)

### üß™ –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:
- **‚â•8 –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤** –≤–∫–ª—é—á–∞—è –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:
  - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (email, –ø–∞—Ä–æ–ª—å, –¥–ª–∏–Ω—ã –ø–æ–ª–µ–π)
  - –ü–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ —Å –Ω–µ–≤–µ—Ä–Ω—ã–º–∏ —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
  - –ê—Ç–∞–∫–∞ –¥–ª–∏–Ω–Ω–æ–π —Å–µ—Ä–∏–µ–π –∑–∞–ø—Ä–æ—Å–æ–≤ (rate limiting)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö HTTP —Å—Ç–∞—Ç—É—Å–æ–≤ (422, 400, 401, 404, 429)

### üìö ADR:
- ADR-001: RFC 7807 Error Format
- ADR-002: Rate Limiting for Login
- ADR-003: Secrets Management

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π P06

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è P06 ‚Äî Secure Coding:
- [x] **–ú–∏–Ω–∏–º—É–º 3 –∫–æ–Ω—Ç—Ä–æ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ 3:
  1. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞ (—Ç–∏–ø—ã, –¥–ª–∏–Ω—ã, —Å—Ç—Ä–æ–≥–∞—è —Å—Ö–µ–º–∞)
  2. –û—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ RFC 7807 (–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ, correlation_id)
  3. –°–µ–∫—Ä–µ—Ç—ã (–∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è/—Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –∑–∞–ø—Ä–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
- [x] **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/...`** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
  - `src/app/utils/errors.py` ‚Äî RFC 7807 –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - `src/app/settings.py` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏
  - `src/app/routers/auth.py` ‚Äî rate limiting
  - `src/domain/schemas.py` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - `src/services/auth.py` ‚Äî Argon2 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] **–¢–µ—Å—Ç—ã –≤ `tests/...` (‚â•3, –≤–∫–ª—é—á–∞—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ/–≥—Ä–∞–Ω–∏—á–Ω—ã–µ)** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
  - `tests/test_rfc7807.py` ‚Äî 2 –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–∞
  - `tests/test_rate_limit.py` ‚Äî 1 –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç (–∞—Ç–∞–∫–∞ –±—Ä—É—Ç—Ñ–æ—Ä—Å–æ–º)
  - `tests/test_errors.py` ‚Äî 1 –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç (404)
  - `tests/test_auth.py` ‚Äî 4+ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–∞ (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –Ω–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
  - –ò—Ç–æ–≥–æ: **‚â•8 –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö/–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤**
- [x] **(–ü–æ –∂–µ–ª–∞–Ω–∏—é) `docs/adr/ADR-xxx-*.md`** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ 3 ADR:
  - `docs/adr/ADR-001-errors-rfc7807.md`
  - `docs/adr/ADR-002-rate-limiting-login.md`
  - `docs/adr/ADR-003-secrets-management.md`
- [x] **–ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –≤ PR: ¬´–∫–∞–∫–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏ –≤–Ω–µ–¥—Ä–µ–Ω—ã, –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è¬ª** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –Ω–∞—á–∞–ª–µ PR (—Ä–∞–∑–¥–µ–ª Summary)

## üìö –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (ADR)

–í PR –≤–∫–ª—é—á–µ–Ω—ã 3 ADR, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—â–∏–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

1. **[ADR-001: RFC 7807 —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫](docs/adr/ADR-001-errors-rfc7807.md)**
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ RFC 7807 (`application/problem+json`)
   - Correlation ID –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–æ–∫ –¥–ª—è 5xx

2. **[ADR-002: Rate Limiting –¥–ª—è –ª–æ–≥–∏–Ω–∞](docs/adr/ADR-002-rate-limiting-login.md)**
   - In-memory rate limiting: 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ IP
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ –∏ credential stuffing –∞—Ç–∞–∫
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 429 (Too Many Requests) –≤ —Ñ–æ—Ä–º–∞—Ç–µ RFC 7807

3. **[ADR-003: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏](docs/adr/ADR-003-secrets-management.md)**
   - –°–µ–∫—Ä–µ—Ç—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`pydantic-settings`)
   - –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –∫–æ–¥ –∏ –ª–æ–≥–∏ (–ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤

## üîó –°–≤—è–∑–∏ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏

### P03 (NFR)
- **NFR-xx**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (ADR-001)
- **NFR-xx**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π (ADR-002)
- **NFR-xx**: –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å (ADR-003)

### P04 (Threat Modeling)
- **F#/R#**: –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–æ–∫ –∏ —É–ª—É—á—à–µ–Ω–∏–µ DX (ADR-001)
- **F#/R#**: –£–≥—Ä–æ–∑—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (STRIDE: D, E) (ADR-002)
- **F#/R#**: –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤ STRIDE (spoofing/tampering) (ADR-003)

### –ú–∏—Ç–∏–≥–∞—Ü–∏—è —Ä–∏—Å–∫–æ–≤
–†–∏—Å–∫–∏ –∏–∑ `docs/p04-threat-model/RISKS.md`:
- **R1, R5**: –ü–æ–¥–¥–µ–ª–∫–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö / –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–∫—Ä–∞–¥–µ–Ω–Ω–æ–≥–æ JWT ‚Äî –º–∏—Ç–∏–≥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏—é JWT –∏ Argon2 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **R2**: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤—Ö–æ–¥ ‚Äî –º–∏—Ç–∏–≥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏—é Pydantic –∏ rate limiting
- **R9**: –£—Ç–µ—á–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äî –º–∏—Ç–∏–≥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Argon2, –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏
- **R10**: –ü–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π ‚Äî –º–∏—Ç–∏–≥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ä–æ–ª–µ–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (`src/app/utils/errors.py`)
- Middleware –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ correlation ID
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, HTTP –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏ –¥–æ–º–µ–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–æ–∫

### Rate Limiting (`src/app/routers/auth.py`)
- In-memory rate limiter –¥–ª—è `/auth/login`
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ IP —Å sliding window

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ (`src/app/settings.py`)
- `pydantic-settings` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –∞–ª–≥–æ—Ä–∏—Ç–º –∏ –¥–ª–∏–Ω–∞ —Å–µ–∫—Ä–µ—Ç–∞, –Ω–µ —Å–∞–º —Å–µ–∫—Ä–µ—Ç)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (`src/app/security.py`, `src/services/auth.py`)
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ Argon2 (`passlib`)
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª–µ–π

## ‚úÖ –¢–µ—Å—Ç—ã

–î–æ–±–∞–≤–ª–µ–Ω–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:

1. **`tests/test_rfc7807.py`**
   - –§–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (422)
   - –§–æ—Ä–º–∞—Ç HTTP –∏—Å–∫–ª—é—á–µ–Ω–∏–π (400) —Å correlation_id
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –¥—É–±–ª–∏—Ä—É—é—â–∏–º—Å—è email

2. **`tests/test_rate_limit.py`**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ rate limiting (429 –ø–æ—Å–ª–µ 5 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ª–æ–≥–∏–Ω–∞)
   - –§–æ—Ä–º–∞—Ç RFC 7807 –¥–ª—è –æ—à–∏–±–æ–∫ rate limiting

3. **`tests/test_errors.py`**
   - –û—à–∏–±–∫–∏ 404 –≤–∫–ª—é—á–∞—é—Ç correlation_id
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ Problem Details

4. **`tests/test_auth.py`**
   - –¢–µ—Å—Ç—ã –ø–æ—Ç–æ–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤

5. **`tests/test_workouts.py`, `tests/test_exercises.py`, `tests/test_stats.py`**
   - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
   - –î–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º –≤ —Ä–∞–º–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `docs/adr/ADR-001-errors-rfc7807.md`
- `docs/adr/ADR-002-rate-limiting-login.md`
- `docs/adr/ADR-003-secrets-management.md`
- `src/app/utils/errors.py` (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ RFC 7807)
- `tests/test_rfc7807.py`
- `tests/test_rate_limit.py`

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `src/app/main.py` (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)
- `src/app/routers/auth.py` (rate limiting)
- `src/app/settings.py` (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏)
- `src/services/auth.py` (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π Argon2)
- `tests/conftest.py` (—Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤)
- `tests/test_errors.py` (—Ñ–æ—Ä–º–∞—Ç RFC 7807)

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç:
- ‚úÖ –¢–µ—Å—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∞ –æ—à–∏–±–æ–∫ RFC 7807
- ‚úÖ –¢–µ—Å—Ç—ã rate limiting
- ‚úÖ –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –¢–µ—Å—Ç—ã CRUD –æ–ø–µ—Ä–∞—Ü–∏–π

## üìù –ß–µ–∫–ª–∏—Å—Ç

- [x] –°–æ–∑–¥–∞–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã 3 ADR
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫ RFC 7807
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω rate limiting –¥–ª—è `/auth/login`
- [x] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [x] Correlation ID –≤–æ –≤—Å–µ—Ö –æ—Ç–≤–µ—Ç–∞—Ö –æ–± –æ—à–∏–±–∫–∞—Ö
- [x] –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (5+ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤)
- [x] –°—Å—ã–ª–∫–∏ –Ω–∞ P03 (NFR) –∏ P04 (Threat Modeling)
- [x] –ú–∏—Ç–∏–≥–∞—Ü–∏—è —Ä–∏—Å–∫–æ–≤ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ ADR

## ‚úÖ P06 –ß–µ–∫-–ª–∏—Å—Ç ‚Äî –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (‚òÖ‚òÖ2 –Ω–∞ –æ—Ü–µ–Ω–∫—É 10)

### C1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (‚òÖ‚òÖ2)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã:**
1. **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî —É—Ç–µ—á–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π —Å–∏—Å—Ç–µ–º—ã —á–µ—Ä–µ–∑ stack traces
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞** ‚Äî –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É
3. **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏** ‚Äî —Å–µ–∫—Ä–µ—Ç—ã –º–æ–≥–ª–∏ –ø–æ–ø–∞–¥–∞—Ç—å –≤ –ª–æ–≥–∏ –∏ –∫–æ–¥

**Diff –∫–æ–¥–∞ (–¥–æ/–ø–æ—Å–ª–µ):**

**–î–æ:** –û—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ –ø–æ–ª–Ω—ã–µ stack traces —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
```python
# –ë—ã–ª–æ: –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏
@app.exception_handler(Exception)
async def handler(request, exc):
    return {"error": str(exc)}  # –£—Ç–µ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏!
```

**–ü–æ—Å–ª–µ:** –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–µ—Ç–∞–ª–µ–π
```python
# src/app/utils/errors.py
@app.exception_handler(Exception)
async def unhandled_exception_handler(request: Request, exc: Exception):
    correlation_id = getattr(request.state, "correlation_id", "-")
    logger.exception("Unhandled error, correlation_id=%s", correlation_id)
    return _problem_json(
        request=request,
        status=HTTP_500_INTERNAL_SERVER_ERROR,
        title="Internal Server Error",
        detail="An unexpected error occurred. Please contact support.",  # –ë–µ–∑–æ–ø–∞—Å–Ω–æ
    )
```

**–î–æ:** –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª rate limiting –¥–ª—è `/auth/login`
```python
# –ë—ã–ª–æ: –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
@router.post("/login")
def login(payload: UserCreate, db: Session):
    # –õ—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫!
```

**–ü–æ—Å–ª–µ:** Rate limiting 5 –∑–∞–ø—Ä–æ—Å–æ–≤/60 —Å–µ–∫—É–Ω–¥ –Ω–∞ IP
```python
# src/app/routers/auth.py
def _rate_limit_login(request: Request) -> None:
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è sliding window rate limiter
    if len(timestamps) >= _RATE_LIMIT_MAX_REQUESTS:
        raise HTTPException(status_code=HTTP_429_TOO_MANY_REQUESTS, ...)
```

**–î–æ:** –°–µ–∫—Ä–µ—Ç—ã –º–æ–≥–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é
```python
# –ë—ã–ª–æ: —Ä–∏—Å–∫ —É—Ç–µ—á–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤
print(f"Secret: {settings.jwt_secret}")  # –û–ø–∞—Å–Ω–æ!
```

**–ü–æ—Å–ª–µ:** –õ–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
```python
# src/app/main.py
print(f"‚úÖ JWT: {settings.jwt_algorithm}, secret len={len(settings.jwt_secret)}")
# –¢–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–µ —Å–∞–º —Å–µ–∫—Ä–µ—Ç
```

**CI-—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç:**
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –≤ CI pipeline (`.github/workflows/ci.yml`)
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç–µ—Ä—ã –ø—Ä–æ—Ö–æ–¥—è—Ç: `ruff check`, `black --check`, `isort --check-only`
- ‚úÖ –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: `tests/test_rfc7807.py`, `tests/test_rate_limit.py`, `tests/test_errors.py`

---

### C2. –¢–µ—Å—Ç—ã (–≤–∫–ª. –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ) (‚òÖ‚òÖ2)

**–§–∞–π–ª—ã —Ç–µ—Å—Ç–æ–≤:**
- `tests/test_rfc7807.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –æ—à–∏–±–æ–∫ RFC 7807 (–≤–∫–ª—é—á–∞—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)
- `tests/test_rate_limit.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ (–∞—Ç–∞–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏)
- `tests/test_errors.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- `tests/test_auth.py` ‚Äî —Ç–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ (–Ω–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–∞–ª–∏–¥–∞—Ü–∏—è)

**–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã (‚â•6 —Ç–µ—Å—Ç–æ–≤):**

1. **`test_validation_problem_details_on_register`** ‚Äî –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π email –∏ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–∞—Ä–æ–ª—å (422)
2. **`test_http_exception_problem_details_on_duplicate_email`** ‚Äî –ø–æ–ø—ã—Ç–∫–∞ –¥—É–±–ª–∏—Ä—É—é—â–µ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (400)
3. **`test_login_rate_limiting_applies`** ‚Äî –∞—Ç–∞–∫–∞ –¥–ª–∏–Ω–Ω–æ–π —Å–µ—Ä–∏–µ–π –∑–∞–ø—Ä–æ—Å–æ–≤ (429 –ø–æ—Å–ª–µ 5 –ø–æ–ø—ã—Ç–æ–∫)
4. **`test_invalid_credentials_login`** ‚Äî –≤—Ö–æ–¥ —Å –Ω–µ–≤–µ—Ä–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º (401)
5. **`test_nonexistent_user_login`** ‚Äî –≤—Ö–æ–¥ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (401)
6. **`test_password_validation`** ‚Äî —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –ø–∞—Ä–æ–ª—å (422)
7. **`test_email_validation`** ‚Äî –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email (422)
8. **`test_problem_details_has_correlation_id_on_404`** ‚Äî –∑–∞–ø—Ä–æ—Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—É—Ç–∏ (404)

**–¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –¥–æ–º–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è:**
- ‚úÖ –ê—Ç–∞–∫–∞ –¥–ª–∏–Ω–Ω–æ–π —Å–µ—Ä–∏–µ–π –∑–∞–ø—Ä–æ—Å–æ–≤ (`test_login_rate_limiting_applies`) ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ rate limiting
- ‚úÖ –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Pydantic
- ‚úÖ –ü–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ —Å –Ω–µ–≤–µ—Ä–Ω—ã–º–∏ —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∞–µ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤ (–ø—É—Å—Ç—ã–µ –ø–æ–ª—è, –≥—Ä–∞–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)

**Pytest –æ—Ç—á—ë—Ç —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º:**
```bash
pytest -q --cov=src --cov-report=term-missing
```
(–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ CI: `.github/workflows/ci.yml` ‚Üí `pytest -q`)

---

### C3. –í–∞–ª–∏–¥–∞—Ü–∏—è/–æ—à–∏–±–∫–∏/–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (‚òÖ‚òÖ2)

**–ö–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** (`src/domain/schemas.py` —á–µ—Ä–µ–∑ Pydantic):
   - Email: –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —á–µ—Ä–µ–∑ `EmailStr`
   - Password: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ —Å—Ö–µ–º–∞—Ö)
   - –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** (`src/app/utils/errors.py`):
   - –í—Å–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ RFC 7807
   - 422 ‚Äî –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ–ª–µ–π)
   - 400, 401, 403, 404, 429 ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã
   - 500 ‚Äî –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—à–∏–±–∫–∏ (–±–µ–∑ —É—Ç–µ—á–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ PII:**
   ```python
   # src/app/utils/errors.py
   logger.exception("Unhandled error, correlation_id=%s", correlation_id)
   # –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ correlation_id, –±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   
   # src/app/main.py
   print(f"‚úÖ JWT: {settings.jwt_algorithm}, secret len={len(settings.jwt_secret)}")
   # –¢–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–µ —Å–∞–º —Å–µ–∫—Ä–µ—Ç
   ```

**–ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤:**
```
INFO: Unhandled error, correlation_id=abc-123-def-456
# –ë–µ–∑ stack traces, –±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

**–¢–µ—Å—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏:**
- ‚úÖ `test_validation_problem_details_on_register` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ 422 —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ `test_http_exception_problem_details_on_duplicate_email` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ 400 —Å correlation_id
- ‚úÖ `test_problem_details_has_correlation_id_on_404` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ 404
- ‚úÖ `test_login_rate_limiting_applies` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ 429 (rate limit)
- ‚úÖ `test_invalid_credentials_login` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ 401

**PII –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –ü–∞—Ä–æ–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (—Ç–æ–ª—å–∫–æ –¥–ª–∏–Ω–∞ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º)
- ‚úÖ Stack traces —Å–∫—Ä—ã—Ç—ã –≤ production (—Ç–æ–ª—å–∫–æ –æ–±—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)

---

### C4. –õ–∏–Ω—Ç/—Ñ–æ—Ä–º–∞—Ç/quality gate (‚òÖ‚òÖ2)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–∏–Ω—Ç–µ—Ä–æ–≤:**

**`pyproject.toml`:**
```toml
[tool.ruff]
line-length = 100
target-version = "py311"
select = ["E", "F", "I", "UP", "B", "SIM", "PL"]  # –í–∫–ª—é—á–∞—è bugbear (B)
ignore = []
exclude = ["venv", ".venv", "build", "dist"]

[tool.black]
line-length = 100
target-version = ["py311"]

[tool.isort]
profile = "black"
line_length = 100
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
- ‚úÖ `ruff` —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ `B` (flake8-bugbear) ‚Äî –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
- ‚úÖ `SIM` (simplify) ‚Äî —É–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞
- ‚úÖ `PL` (pylint) ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
- ‚úÖ `black` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- ‚úÖ `isort` ‚Äî —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤

**CI Quality Gate:**

**`.github/workflows/ci.yml`:**
```yaml
- name: Lint & Format
  run: |
    ruff check --output-format=github .
    black --check .
    isort --check-only .

- name: Tests
  run: pytest -q

- name: Pre-commit (all files)
  run: pre-commit run --all-files
```

**CI –±–ª–æ–∫–∏—Ä—É–µ—Ç merge –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:**
- ‚úÖ `ruff check` –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ
- ‚úÖ `black --check` –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- ‚úÖ `isort --check-only` –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤)
- ‚úÖ `pytest` –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã
- ‚úÖ `pre-commit` –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ –≤—Å–µ —Ö—É–∫–∏

**CI run:** –°–º. GitHub Actions workflow (`.github/workflows/ci.yml`) ‚Äî –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PR.

---

### C5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –º–æ–¥—É–ª—å –ø—Ä–æ–µ–∫—Ç–∞ (‚òÖ‚òÖ2)

**–§–∏–∫—Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Ä–∞–±–æ—á–∏–π –º–æ–¥—É–ª—å —Å–≤–æ–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:**

1. **`src/app/utils/errors.py`** ‚Äî –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `src/app/main.py` —á–µ—Ä–µ–∑ `add_error_handlers(app)`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

2. **`src/app/routers/auth.py`** ‚Äî rate limiting –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Ä–æ—É—Ç–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ó–∞—â–∏—â–∞–µ—Ç `/auth/login` endpoint
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç dependency injection FastAPI

3. **`src/app/settings.py`** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ —á–µ—Ä–µ–∑ `pydantic-settings`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (`src/app/security.py`, `src/app/main.py`)

4. **`src/services/auth.py`** ‚Äî Argon2 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã:**
- ‚úÖ `tests/test_rfc7807.py` ‚Äî —Ç–µ—Å—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∞ –æ—à–∏–±–æ–∫
- ‚úÖ `tests/test_rate_limit.py` ‚Äî —Ç–µ—Å—Ç—ã rate limiting
- ‚úÖ `tests/test_errors.py` ‚Äî —Ç–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã (`tests/test_auth.py`, `tests/test_errors.py`)

**–ü—Ä–∏–≤—è–∑–∫–∞ –∫ Issue/–∏—Å—Ç–æ—Ä–∏–∏:**
- üìù **Issue:** [–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ Issue –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è]
- üìö **–°–≤—è–∑—å —Å –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏:** 
  - P03 (NFR) ‚Äî —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (SEC-01, SEC-03, SEC-06)
  - P04 (Threat Modeling) ‚Äî —Ä–∏—Å–∫–∏ R1, R2, R5, R9 –∏–∑ `docs/p04-threat-model/RISKS.md`
- üìã **ADR –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—Ç —Ä–µ—à–µ–Ω–∏—è:**
  - ADR-001: RFC 7807 Error Format
  - ADR-002: Rate Limiting for Login
  - ADR-003: Secrets Management

**PR –≤ —Å–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
- üîó **Branch:** `p05-secure-coding`
- üîó **PR:** [–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ PR –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è]

---

## üîç –ó–∞–º–µ—á–∞–Ω–∏—è –¥–ª—è —Ä–µ–≤—å—é

- Rate limiting —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω in-memory (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è single-instance —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–π)
- –†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ –¥–µ–ª–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–∫–µ–Ω—ã –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ (–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞)
- –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è –¥–ª—è 5xx, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —É—Ç–µ—á–∫—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –í—Å–µ –æ—Ç–≤–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö —Å–ª–µ–¥—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É RFC 7807 –¥–ª—è –∏–Ω—Ç–µ—Ä–æ–ø–µ—Ä–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏

## üîó –°—Å—ã–ª–∫–∏

- [ADR-001: RFC 7807](docs/adr/ADR-001-errors-rfc7807.md)
- [ADR-002: Rate Limiting](docs/adr/ADR-002-rate-limiting-login.md)
- [ADR-003: Secrets Management](docs/adr/ADR-003-secrets-management.md)
- [–†–∏—Å–∫–∏ (RISKS.md)](docs/p04-threat-model/RISKS.md)
- [NFR](docs/security-nfr/NFR.md)


